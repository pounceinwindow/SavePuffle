<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="GravityFalls.Client.Pages.GamePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Ð˜Ð³Ñ€Ð°">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="Ink">#2B1B12</Color>
            <Color x:Key="Parchment1">#F6E7C6</Color>
            <Color x:Key="Parchment2">#EBD5A6</Color>
            <Color x:Key="Line">#B8935E</Color>
            <Color x:Key="Accent">#C85B23</Color>
            <Color x:Key="Muted">#7A5E3C</Color>
            <Color x:Key="Good">#2E7D32</Color>
            <Color x:Key="Bad">#B71C1C</Color>

            <LinearGradientBrush x:Key="ParchmentBrush" EndPoint="0,1">
                <GradientStop Color="{StaticResource Parchment1}" Offset="0" />
                <GradientStop Color="{StaticResource Parchment2}" Offset="1" />
            </LinearGradientBrush>

            <Style TargetType="Label" x:Key="H1">
                <Setter Property="TextColor" Value="{StaticResource Ink}" />
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <Style TargetType="Label" x:Key="H2">
                <Setter Property="TextColor" Value="{StaticResource Ink}" />
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <Style TargetType="Label" x:Key="SmallMuted">
                <Setter Property="TextColor" Value="{StaticResource Muted}" />
                <Setter Property="FontSize" Value="12" />
            </Style>

            <Style TargetType="Button" x:Key="PrimaryButton">
                <Setter Property="BackgroundColor" Value="{StaticResource Accent}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="HeightRequest" Value="50" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="FontSize" Value="18" />
            </Style>

            <Style TargetType="Button" x:Key="SecondaryButton">
                <Setter Property="BackgroundColor" Value="#E8C98A" />
                <Setter Property="TextColor" Value="{StaticResource Ink}" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="HeightRequest" Value="46" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <Style TargetType="Button" x:Key="ChipButton">
                <Setter Property="BackgroundColor" Value="#E8C98A" />
                <Setter Property="TextColor" Value="{StaticResource Ink}" />
                <Setter Property="CornerRadius" Value="14" />
                <Setter Property="HeightRequest" Value="40" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Padding" Value="14,0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Image Source="wood_bg.png" Aspect="AspectFill" />
        <BoxView Opacity="0.18" BackgroundColor="Black" />

        <Grid Padding="16" RowDefinitions="Auto,*" RowSpacing="12">
            <Border Stroke="{StaticResource Line}" StrokeThickness="3" StrokeShape="RoundRectangle 18" Background="{StaticResource ParchmentBrush}">
                <Border.Shadow>
                    <Shadow Opacity="0.45" Radius="18" Offset="0,8" />
                </Border.Shadow>

                <Grid Padding="14" ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" RowSpacing="4">
                    <VerticalStackLayout Spacing="2">
                        <Label Text="Ð¡ÐŸÐÐ¡Ð¢Ð˜ ÐŸÐ£Ð¥Ð›Ð®" Style="{StaticResource H1}" />
                        <Label x:Name="MeLabel" Text="Ð’Ñ‹: ..." Style="{StaticResource SmallMuted}" />
                    </VerticalStackLayout>

                    <Button x:Name="LeaveButton" StyleClass="chipBtn" Grid.Column="1" Text="Ð’Ñ‹Ð¹Ñ‚Ð¸" Style="{StaticResource ChipButton}" />

                    <Label x:Name="TurnLabel" Grid.Row="1" Grid.ColumnSpan="2" Text="ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ..." TextColor="{StaticResource Ink}" FontAttributes="Bold" />
                </Grid>
            </Border>

            <Grid Grid.Row="1" ColumnDefinitions="*,12,360" RowDefinitions="*">

                <Border Grid.Column="0" Stroke="{StaticResource Line}" StrokeThickness="3" StrokeShape="RoundRectangle 18" Background="{StaticResource ParchmentBrush}">
                    <Border.Shadow>
                        <Shadow Opacity="0.35" Radius="16" Offset="0,6" />
                    </Border.Shadow>

                    <Grid Padding="12" RowDefinitions="Auto,*" RowSpacing="10">
                        <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                            <Label Text="ÐŸÐ¾Ð»Ðµ" Style="{StaticResource H2}" />
                            <Border Grid.Column="1" Stroke="{StaticResource Line}" StrokeThickness="2" StrokeShape="RoundRectangle 14" BackgroundColor="#F9EFD6" Padding="10,6">
                                <Label x:Name="WaddlesInfo" Text="ðŸ· ÐµÑ‰Ñ‘ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" Style="{StaticResource SmallMuted}" />
                            </Border>
                        </Grid>

                        <ScrollView Grid.Row="1" Orientation="Both">
                            <Grid>
                                <AbsoluteLayout x:Name="BoardAbs" />
                            </Grid>
                        </ScrollView>
                    </Grid>
                </Border>

                <Border Grid.Column="2" Stroke="{StaticResource Line}" StrokeThickness="3" StrokeShape="RoundRectangle 18" Background="{StaticResource ParchmentBrush}">
                    <Border.Shadow>
                        <Shadow Opacity="0.35" Radius="16" Offset="0,6" />
                    </Border.Shadow>

                    <Grid Padding="14" RowDefinitions="Auto,Auto,Auto,*" RowSpacing="12">
                        <Label Text="Ð˜Ð³Ñ€Ð¾ÐºÐ¸" Style="{StaticResource H2}" />

                        <CollectionView x:Name="PlayersView" Grid.Row="1" HeightRequest="220">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border Stroke="{StaticResource Line}" StrokeThickness="2" StrokeShape="RoundRectangle 14" BackgroundColor="#F9EFD6" Padding="10" Margin="0,0,0,6">
                                        <Grid ColumnDefinitions="Auto,10,*,Auto" RowDefinitions="Auto,Auto" RowSpacing="4">
                                            <Border Grid.RowSpan="2" Stroke="{StaticResource Line}" StrokeThickness="2" StrokeShape="RoundRectangle 999" BackgroundColor="#FFFFFF" WidthRequest="42" HeightRequest="42">
                                                <Label Text="{Binding HeroEmoji}" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center" />
                                            </Border>

                                            <Label Grid.Column="2" Grid.Row="0" Text="{Binding NameLine}" TextColor="{StaticResource Ink}" FontAttributes="Bold" LineBreakMode="TailTruncation" />

                                            <HorizontalStackLayout Grid.Column="2" Grid.Row="1" Spacing="6">
                                                <Border Stroke="{StaticResource Line}" StrokeThickness="1" StrokeShape="RoundRectangle 999" BackgroundColor="#E8C98A" Padding="8,2">
                                                    <Label Text="{Binding PosChip}" Style="{StaticResource SmallMuted}" />
                                                </Border>
                                                <Border Stroke="{StaticResource Line}" StrokeThickness="1" StrokeShape="RoundRectangle 999" BackgroundColor="#FFFFFF" Padding="8,2">
                                                    <Label Text="{Binding TokensChip}" Style="{StaticResource SmallMuted}" />
                                                </Border>
                                                <Border Stroke="{StaticResource Line}" StrokeThickness="1" StrokeShape="RoundRectangle 999" BackgroundColor="#FFFFFF" Padding="8,2" IsVisible="{Binding HasWaddles}">
                                                    <Label Text="ðŸ·" Style="{StaticResource SmallMuted}" />
                                                </Border>
                                                <Border Stroke="{StaticResource Line}" StrokeThickness="1" StrokeShape="RoundRectangle 999" BackgroundColor="#FFFFFF" Padding="8,2" IsVisible="{Binding SkipChipVisible}">
                                                    <Label Text="ðŸ’¤" Style="{StaticResource SmallMuted}" />
                                                </Border>
                                            </HorizontalStackLayout>

                                            <Label Grid.Column="3" Grid.RowSpan="2" Text="{Binding TurnChip}" TextColor="{StaticResource Ink}" FontAttributes="Bold" VerticalOptions="Center" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <Border Grid.Row="2" Stroke="{StaticResource Line}" StrokeThickness="2" StrokeShape="RoundRectangle 16" BackgroundColor="#F9EFD6" Padding="12">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ" Style="{StaticResource H2}" />

                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" VerticalOptions="Center">
                                    <Border x:Name="DiceBox" Stroke="{StaticResource Line}" StrokeThickness="2" StrokeShape="RoundRectangle 16" BackgroundColor="#FFFFFF" WidthRequest="74" HeightRequest="74">
                                        <Label x:Name="DiceFace" Text="?" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource Ink}" HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" Spacing="6">
                                        <Button x:Name="RollButton" StyleClass="primaryBtn" Text="Ð‘Ð ÐžÐ¡Ð˜Ð¢Ð¬" Style="{StaticResource PrimaryButton}" />
                                        <Button x:Name="ExchangeButton" StyleClass="secondaryBtn" Text="ÐžÐ‘ÐœÐ•Ð ðŸ˜ˆâ†’âœ¨" Style="{StaticResource SecondaryButton}" />
                                    </VerticalStackLayout>
                                </Grid>

                                <Label x:Name="HintLabel" StyleClass="mutedLabel" Text="Ð¥Ð¾Ð´Ð¸Ñ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¸Ð³Ñ€Ð¾Ðº." Style="{StaticResource SmallMuted}" />
                            </VerticalStackLayout>
                        </Border>

                        <Border Grid.Row="3" Stroke="{StaticResource Line}" StrokeThickness="2" StrokeShape="RoundRectangle 16" BackgroundColor="#E8C98A" Padding="12">
                            <Grid RowDefinitions="Auto,*" RowSpacing="8">
                                <Label  TextColor="{StaticResource Ink}" FontAttributes="Bold" />
                                <CollectionView x:Name="EventsView" Grid.Row="1" HeightRequest="220">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Label Text="{Binding .}" TextColor="{StaticResource Ink}" FontSize="12" />
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </Grid>
                        </Border>

                    </Grid>
                </Border>

            </Grid>
        </Grid>
    </Grid>
</ContentPage>
